# Animal Family Backend

A Go backend API for managing animal care tasks, enclosures, and related data.

**Frontend Repository:** [animal-family-web](https://github.com/whitallee/animal-family-web)

> **Note:** This is currently in Pre-Alpha. If you'd like to collaborate, please reach out! Find my contact info on [whitcodes.dev/contact](https://whitcodes.dev/contact).

## Prerequisites

- Go 1.23.4 or later
- PostgreSQL
- Make (optional, for using Makefile commands)

## Running Locally

### 1. Clone the Repository

```bash
git clone https://github.com/whitallee/animal-family-backend.git
cd animal-family-backend
```

### 2. Set Up Environment Variables

Create a `.env` file in the root directory with the following variables:

```env
JWT_SECRET
FRONTEND_URL

# These are the values for running locally
PUBLIC_HOST=http://localhost
PORT=8080

# I'm using a railway server for my database, which is where I get these from
DB_USER
DB_PASSWORD
DB_HOST
DB_PORT
DB_NAME
```

### 3. Set Up Database

Ensure PostgreSQL is running and create the database:

```bash
createdb animal_family
```

### 4. Run Migrations

Run database migrations and seed data:

```bash
make migrate-up
```

### 5. Build and Run

Using Make:

```bash
make run
```

Or manually:

```bash
go build -o bin/animal-family-backend cmd/main.go
./bin/animal-family-backend
```

The API server will start on `http://localhost:8080`.

## Available Make Commands

- `make build` - Build the application
- `make run` - Build and run the application
- `make test` - Run all tests
- `make migrate-up` - Run database migrations and seed data
- `make migrate-down` - Rollback database migrations
- `make seed` - Seed the database with initial data
- `make migration <name>` - Create a new migration file

## Project Structure

- `cmd/` - Application entry points (main.go, api/, migrate/)
- `config/` - Configuration management
- `db/` - Database connection and setup
- `service/` - Business logic and route handlers
- `types/` - Type definitions
- `utils/` - Utility functions

## Database Schema

[Entity Relationship Diagram](https://docs.google.com/drawings/d/1Vi1yngr4CeXXt-slRGJsLI35_R-y-oIHlZ466be_wx8/edit?usp=sharing)

## Development Status

### Completed Endpoints
- âœ… User
- âœ… Habitat
- âœ… Species
- âœ… Enclosure
- âœ… Animal
- ðŸ”„ Task (in progress)

### To-Do

- [ ] Ensure taskSubject is included when tasks are called
- [ ] Consider multiple subjects on a task (e.g., all 4 ferrets for feeding instead of applying the task to the whole enclosure)
- [ ] Check all admin/auth endpoints for proper return values
- [ ] Add duplicate check when changing ownership
- [ ] Modularize common checks and actions in routes to reduce repetition
- [ ] Add CreateAnimalAndEnclosure and/or CreateEnclosureAndAnimals for simultaneous creation
- [ ] Add UpdateUser and UpdateSubject functions and routes to all services
  - handleUserUpdateAnimalOwner (needs to send a request for another user to accept)
  - handleUserUpdateEnclosureOwner (needs to send a request for another user to accept)
  - handleUserUpdateTaskOwner (needs to send a request for another user to accept)
- [ ] Make every transaction function properly (i.e., rollback on error)
- [ ] Implement Action History Feature
- [ ] Use GoRoutines/WaitGroups for concurrent async requests (e.g., DeleteUserById animal and enclosure looped db requests)
  - Will need to create more modular store functions to implement this

## Frontend Plans

- Use a cache heavily and store all user animals, enclosures, and tasks
  - Invalidate and refetch cache every 15 minutes
  - Invalidate and refetch cache if user updates any of their animals, enclosures, or tasks
  - Should improve performance massively compared to v1 Next.js frontend

- Species and Habitat information will be generated by AI, and validated and edited by a real person over time, in order to create a solid ground for the knowledge base
  - All AI generated information will have a flag in the app that discloses that it is AI generated and that we are working on the validation and editing process to remove any non-reviewed AI text
